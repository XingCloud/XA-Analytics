<table>
    <tr>
        <td>
            <ul class="dimension-tags control-tags">
                <% if @dimensions_filters.length > 0: %>
                    <li class="filter all">
                        <i class="icon-folder-open"></i>
                        <a><%= I18n.t("templates.dimensions.tags.all") %></a>
                    </li>
                <% end %>
                <% for filter in @dimensions_filters: %>
                    <li class="filter-path-splitter">&nbsp;Â»&nbsp;</li>
                    <li class="filter" key="<%= filter.dimension.value %>" key_type="<%= filter.dimension.dimension_type %>" value="<%= filter.value %>" value_type="<%= filter.dimension.value_type %>">
                        <i class="icon-folder-open"></i>
                        <% if filter != _.last(@dimensions_filters): %>
                            <a><%= Analytics.Static.getDimensionName(filter.dimension.value) %>:<%= filter.value %></a>
                        <% else: %>
                            <%= Analytics.Static.getDimensionName(filter.dimension.value) %>:<%= filter.value %>
                        <% end %>
                    </li>
                <% end %>
                <% if @dimensions_filters.length > 0: %>
                    <li class="divider"><strong>&nbsp;|&nbsp;</strong></li>
                <% end %>
                <% for dimension in @dimensions: %>
                    <% active = (@dimension? and dimension.dimension_type == @dimension.dimension_type and dimension.value == @dimension.value) %>
                    <% filter = _.find(@dimensions_filters, (filter) -> filter.dimension.value == dimension.value and filter.dimension.dimension_type == dimension.dimension_type) %>
                    <% if not filter?: %>
                        <li class="dimension-tag control-tag <%= if active then 'active' %> ">
                            <table>
                                <tr>
                                    <td class="tag" dimension-value="<%= dimension.value %>" dimension-type="<%= dimension.dimension_type %>">
                                        <span><%= Analytics.Static.getDimensionName(dimension.value) %></span>
                                    </td>
                                    <td>
                                        <i class="icon-remove-sign" dimension-value="<%= dimension.value %>" dimension-type="<%= dimension.dimension_type %>" ></i>
                                    </td>
                                </tr>
                            </table>
                        </li>
                    <% end %>
                <% end %>
            </ul>
        </td>
        <td class="add-container">
            <div class="add-dimension add-tag left">
                <div class="dropdown">
                    <a class="btn dropdown-toggle" data-toggle="dropdown">
                        <% if @dimensions_filters.length > 0 or @dimensions.length > 0: %>
                            <i class="icon-plus"/>
                            <i class="icon-tags"/>
                        <% else: %>
                            <i class="icon-tags"/>
                        <% end %>
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <div class="tag-list">
                                <% for dimension in Analytics.Static.getDimensions(): %>
                                    <% exist = _.find(@dimensions, (di) -> di.dimension_type == dimension.dimension_type and di.value == dimension.value) %>
                                    <% filter_exist = _.find(@dimension_filters, (filter) -> filter.dimension.dimension_type == dimension.dimension_type and filter.dimension.value == dimension.value) %>
                                    <% if not exist? and not filter_exist?: %>
                                        <div class="tag" value="<%= dimension.value %>" name="<%= dimension.name %>" dimension_type="<%= dimension.dimension_type %>" value_type="<%= dimension.value_type %>">
                                            <%= dimension.name %>
                                        </div>
                                    <% end %>
                                <% end %>
                            </div>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="manage-tags" href="<%= Analytics.Utils.hrefWrapper('settings/user_attributes') %>">
                                <i class="icon-cog"/>
                                <%= I18n.t("templates.dimensions.tags.manage") %>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </td>
    </tr>
</table>